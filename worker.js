//设置变量SUB,节点名称设为Country-名称，优选ip设置为ip.sb,会自动替换国家和优选
//订阅链接格式:域名/token=值?cf_port=值
//以下是我找到的优选ip的api地址，你也可以搭建自己的api
//https://raw.githubusercontent.com/ztwww2222/youxuanyuming/refs/heads/main/ip.txt
//https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestproxy.txt
//https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestcf.txt
//https://ip.164746.xyz/ipTop10.html
//https://raw.githubusercontent.com/ZhiXuanWang/cf-speed-dns/refs/heads/main/ipTop10.html
//https://vps789.com/public/sum/cfIpApi
//https://www.wetest.vip/api/cf2dns/get_cloudflare_ip&type=v4&key=o1zrmHAF
//https://raw.githubusercontent.com/cmliu/WorkerVless2sub/main/addressesapi.txt
//https://addressesapi.090227.xyz/CloudFlareYes
//https://addressesapi.090227.xyz/ip.164746.xyz
const CONFIG = {
    TOKEN: '111',  //订阅链接密钥
    API: 'https://raw.githubusercontent.com/ZhiXuanWang/cf-speed-dns/refs/heads/main/ipTop10.html;https://vps789.com/public/sum/cfIpApi',  //优选ip的api,多个用;隔开
    SUB: '',  //自定义链接,多个用;隔开
    CFIPS: 'ip.sb;bestcf.030101.xyz;cf.090227.xyz' ,//优选域名,多个用;隔开
    COUNTRY_REPLACE: 'YM' // 优选域名节点国家的拼音简称
};
//排除包含关键词的节点
const excludeKeywords = 'GB-eu.com;TW-free.tw';

const _0x27e317=_0x173b;(function(_0x528825,_0x15f4fe){const _0x1fa4a9=_0x173b,_0x163631=_0x528825();while(!![]){try{const _0x3e9830=-parseInt(_0x1fa4a9(0x16b))/0x1+-parseInt(_0x1fa4a9(0x146))/0x2*(parseInt(_0x1fa4a9(0x173))/0x3)+-parseInt(_0x1fa4a9(0x154))/0x4*(-parseInt(_0x1fa4a9(0x158))/0x5)+-parseInt(_0x1fa4a9(0x164))/0x6*(parseInt(_0x1fa4a9(0x16e))/0x7)+parseInt(_0x1fa4a9(0x157))/0x8*(-parseInt(_0x1fa4a9(0x130))/0x9)+parseInt(_0x1fa4a9(0x16d))/0xa*(parseInt(_0x1fa4a9(0x16c))/0xb)+parseInt(_0x1fa4a9(0x176))/0xc;if(_0x3e9830===_0x15f4fe)break;else _0x163631['push'](_0x163631['shift']());}catch(_0xac391a){_0x163631['push'](_0x163631['shift']());}}}(_0x2a1b,0xbd20c));const PROTOCOL={'xieyi':'vl','xieyi2':_0x27e317(0x16a),'pm':'vm'};function preProcessUrl(_0x51fc7d){const _0x2a8ab4=_0x27e317,_0x2e37fb=(_0x51fc7d[_0x2a8ab4(0x159)](_0x2a8ab4(0x15d))||_0x51fc7d[_0x2a8ab4(0x159)](PROTOCOL['pm']+_0x2a8ab4(0x14c)))&&_0x51fc7d[_0x2a8ab4(0x14d)](_0x2a8ab4(0x174))[0x1]['charAt'](0x0)!=='{';if(_0x2e37fb){const _0x3dc782=atob(_0x51fc7d[_0x2a8ab4(0x14d)](_0x2a8ab4(0x174))[0x1]);return PROTOCOL['pm']+'ess://'+_0x3dc782[_0x2a8ab4(0x14a)](/\{PASS\}\-/g,'')[_0x2a8ab4(0x14a)](/\{PA/g,PROTOCOL[_0x2a8ab4(0x149)])[_0x2a8ab4(0x14a)](/SS\}/g,PROTOCOL[_0x2a8ab4(0x168)])[_0x2a8ab4(0x14a)](/\{BA/g,PROTOCOL['pm']);}return _0x51fc7d[_0x2a8ab4(0x14a)](/\{PASS\}\-/g,'')[_0x2a8ab4(0x14a)](/\{PA/g,PROTOCOL[_0x2a8ab4(0x149)])['replace'](/SS\}/g,PROTOCOL['xieyi2'])[_0x2a8ab4(0x14a)](/\{BA/g,PROTOCOL['pm']);}function _0x2a1b(){const _0x28d2b6=['isArray','concat','xieyi','replace','Not\x20Found','ess://','split','https://ipinfo.io/','cfips','get','Hello\x20World','COUNTRY_REPLACE','all','451016NLCJRR','url','No\x20valid\x20IP\x20data\x20found','16904pVxBGB','55wtHHgP','startsWith','status','No\x20valid\x20IP\x20data\x20found\x20from\x20any\x20API\x20endpoints','length','{BASS}://','Error\x20processing\x20IP\x20data','filter','includes','text/plain','map','parse','18CyNYYB','8080','unknown','toLowerCase','xieyi2','http://','ess','1106461LXvnMU','4153567ZGwySO','30kJWBTB','2777474FvHQxs','SUB','/token=','处理订阅链接失败:','country','1403439xSlvVk','://','json','32666532FpMelj','No\x20API\x20endpoints\x20provided','Error\x20fetching\x20or\x20processing\x20IP\x20data:','join','push','4635UpAATS','string','Error\x20fetching\x20data\x20from\x20','text','some','=none','API','match','Error\x20fetching\x20country\x20for\x20IP\x20','log','Missing\x20cf_port','warn','trimStart','error','headers','trim','TOKEN','pathname','sub','object','Error\x20fetching\x20or\x20processing\x20data','Country','4KzrxjX'];_0x2a1b=function(){return _0x28d2b6;};return _0x2a1b();}function _0x173b(_0x1f9a33,_0x378df2){const _0x2a1bca=_0x2a1b();return _0x173b=function(_0x173bd7,_0xddcbe0){_0x173bd7=_0x173bd7-0x12c;let _0x35f922=_0x2a1bca[_0x173bd7];return _0x35f922;},_0x173b(_0x1f9a33,_0x378df2);}function shouldExcludeUrl(_0x103c27){const _0x1a494a=_0x27e317;return excludeKeywords[_0x1a494a(0x14d)](';')[_0x1a494a(0x162)](_0x49fb21=>_0x49fb21[_0x1a494a(0x13f)]())[_0x1a494a(0x134)](_0x22c2b6=>_0x103c27[_0x1a494a(0x160)](_0x22c2b6));}function getSubUrls(_0x39ace8,_0x27f484){const _0x364c96=_0x27e317,_0x4b3a51=_0x27f484['get'](_0x364c96(0x142));if(_0x4b3a51)return _0x4b3a51['split'](';')[_0x364c96(0x162)](_0x42bad1=>_0x42bad1[_0x364c96(0x13f)]())['map'](_0x433fcc=>preProcessUrl(_0x433fcc))[_0x364c96(0x15f)](_0xeea31f=>typeof _0xeea31f==='string'&&!shouldExcludeUrl(_0xeea31f));return(_0x39ace8[_0x364c96(0x16f)]||'')['split'](';')[_0x364c96(0x162)](_0x320175=>_0x320175[_0x364c96(0x13f)]())[_0x364c96(0x162)](_0x33b2da=>preProcessUrl(_0x33b2da))[_0x364c96(0x15f)](_0x47323c=>typeof _0x47323c===_0x364c96(0x131)&&!shouldExcludeUrl(_0x47323c));}async function extractIpsFromResponse(_0x2395e2){const _0x98a550=_0x27e317;let _0xf433a2=[];const _0x2db734=_0x2395e2[_0x98a550(0x13e)]['get']('content-type');let _0x5be43b;try{_0x5be43b=await _0x2395e2[_0x98a550(0x133)]();if(_0x2db734&&_0x2db734[_0x98a550(0x160)]('application/json'))try{_0x5be43b=JSON[_0x98a550(0x163)](_0x5be43b);const _0x202b8e=_0x17ce83=>{const _0x7cb1eb=_0x98a550;if(typeof _0x17ce83==='string'){const _0x23309f=_0x17ce83[_0x7cb1eb(0x137)](/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/g);_0x23309f&&_0xf433a2[_0x7cb1eb(0x12f)](..._0x23309f[_0x7cb1eb(0x162)](_0x588821=>_0x588821[_0x7cb1eb(0x13f)]()));}else{if(Array[_0x7cb1eb(0x147)](_0x17ce83))_0x17ce83['forEach'](_0x594b57=>{const _0x30f4cf=_0x7cb1eb;if(typeof _0x594b57===_0x30f4cf(0x131)){const _0x433820=_0x594b57['match'](/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/g);_0x433820&&_0xf433a2[_0x30f4cf(0x12f)](..._0x433820[_0x30f4cf(0x162)](_0x51cd6d=>_0x51cd6d['trim']()));}else typeof _0x594b57===_0x30f4cf(0x143)&&_0x202b8e(_0x594b57);});else{if(typeof _0x17ce83===_0x7cb1eb(0x143)&&_0x17ce83!==null)for(const _0x26c031 in _0x17ce83){_0x17ce83['hasOwnProperty'](_0x26c031)&&_0x202b8e(_0x17ce83[_0x26c031]);}}}};_0x202b8e(_0x5be43b);}catch(_0x2d7e81){console[_0x98a550(0x13d)]('Error\x20parsing\x20JSON',_0x2d7e81);const _0x571a97=_0x5be43b['match'](/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/g)||[];_0xf433a2[_0x98a550(0x12f)](..._0x571a97[_0x98a550(0x162)](_0x4be51a=>_0x4be51a[_0x98a550(0x13f)]()));}else{const _0x4dcdf2=_0x5be43b[_0x98a550(0x137)](/(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/g)||[];_0xf433a2['push'](..._0x4dcdf2[_0x98a550(0x162)](_0x33afa8=>_0x33afa8[_0x98a550(0x13f)]()));}}catch(_0x21bf44){console[_0x98a550(0x13d)](_0x98a550(0x144),_0x21bf44);}return[...new Set(_0xf433a2)][_0x98a550(0x15f)](Boolean);}export default{async 'fetch'(_0xb431a3,_0x405870){const _0x4b5ee8=_0x27e317,_0x4d5b38=new URL(_0xb431a3['url']);if(_0x4d5b38['pathname']==='/'||_0x4d5b38[_0x4b5ee8(0x141)]==='')return new Response(_0x4b5ee8(0x151),{'headers':{'content-type':_0x4b5ee8(0x161)}});if(_0x4d5b38[_0x4b5ee8(0x141)]===_0x4b5ee8(0x170)+CONFIG[_0x4b5ee8(0x140)])return handleToken(_0xb431a3,_0x405870);return new Response(_0x4b5ee8(0x14b),{'status':0x194});}};async function handleToken(_0x3a4778,_0x548f27){const _0x40b4c2=_0x27e317,_0x1ebca7=new URL(_0x3a4778[_0x40b4c2(0x155)])['searchParams'],_0x3b852e=_0x1ebca7[_0x40b4c2(0x150)]('cf_port');if(!_0x3b852e)return new Response(_0x40b4c2(0x13a),{'status':0x190});let _0x28c21e=[],_0x4cb75c=[];const _0x2ff35e=_0x548f27[_0x40b4c2(0x136)];_0x2ff35e&&(_0x4cb75c=_0x2ff35e[_0x40b4c2(0x14d)](';')[_0x40b4c2(0x162)](_0x26f559=>_0x26f559[_0x40b4c2(0x13f)]())[_0x40b4c2(0x15f)](Boolean));_0x4cb75c['length']===0x0&&(_0x4cb75c=(CONFIG[_0x40b4c2(0x136)]||'')[_0x40b4c2(0x14d)](';')[_0x40b4c2(0x162)](_0x3e4b6f=>_0x3e4b6f[_0x40b4c2(0x13f)]())[_0x40b4c2(0x15f)](Boolean));if(_0x4cb75c['length']===0x0)return new Response(_0x40b4c2(0x12c),{'status':0x190});try{let _0xccc12f=[];for(const _0x2f68f9 of _0x4cb75c){try{const _0x243b04=await fetch(_0x2f68f9);if(!_0x243b04['ok']){console[_0x40b4c2(0x13d)]('HTTP\x20Error\x20for\x20'+_0x2f68f9+':\x20'+_0x243b04[_0x40b4c2(0x15a)]);continue;}const _0x42c2e0=await extractIpsFromResponse(_0x243b04);_0xccc12f[_0x40b4c2(0x12f)](..._0x42c2e0);}catch(_0x3ebae3){console['error'](_0x40b4c2(0x132)+_0x2f68f9+':',_0x3ebae3);}}if(_0xccc12f[_0x40b4c2(0x15c)]===0x0)return new Response(_0x40b4c2(0x15b),{'status':0x190});const _0x45bc69=[...new Set(_0xccc12f)]['filter'](Boolean);_0x28c21e=await Promise[_0x40b4c2(0x153)](_0x45bc69[_0x40b4c2(0x162)](async _0x491a6a=>{const _0x3a82c1=_0x40b4c2;try{const _0x10d121=await fetch(_0x3a82c1(0x14e)+_0x491a6a['split'](':')[0x0]+'/json');if(!_0x10d121['ok'])return console[_0x3a82c1(0x13b)](_0x3a82c1(0x138)+_0x491a6a+':\x20'+_0x10d121[_0x3a82c1(0x15a)]),{'ip':_0x491a6a,'country':'unknown'};return{'ip':_0x491a6a,'country':(await _0x10d121[_0x3a82c1(0x175)]())['country']||_0x3a82c1(0x166)};}catch(_0x250279){return console[_0x3a82c1(0x13b)]('Error\x20fetching\x20country\x20for\x20IP\x20'+_0x491a6a+':\x20'+_0x250279),{'ip':_0x491a6a,'country':_0x3a82c1(0x166)};}}));if(_0x28c21e[_0x40b4c2(0x15c)]===0x0)return new Response(_0x40b4c2(0x156),{'status':0x190});}catch(_0x4fda7e){return console[_0x40b4c2(0x13d)](_0x40b4c2(0x12d),_0x4fda7e),new Response(_0x40b4c2(0x15e),{'status':0x1f4});}let _0x12abd1=getSubUrls(_0x548f27,_0x1ebca7);const _0x535f4f=_0x12abd1[_0x40b4c2(0x15f)](_0x247ddf=>!excludeKeywords[_0x40b4c2(0x14d)](';')['map'](_0x58db5a=>_0x58db5a[_0x40b4c2(0x13f)]())['some'](_0x20f319=>_0x247ddf['includes'](_0x20f319)));let _0x4c50bc=[],_0x8d6d9a=[];const _0x3fa686=_0x1ebca7['get'](_0x40b4c2(0x14f));_0x3fa686?_0x8d6d9a=_0x3fa686[_0x40b4c2(0x14d)](';')[_0x40b4c2(0x162)](_0x1bc6cc=>_0x1bc6cc[_0x40b4c2(0x13f)]())['filter'](Boolean):_0x8d6d9a=(CONFIG['CFIPS']||'')[_0x40b4c2(0x14d)](';')[_0x40b4c2(0x162)](_0x510b46=>_0x510b46[_0x40b4c2(0x13f)]())[_0x40b4c2(0x15f)](Boolean);for(const _0x490fad of _0x535f4f){for(const _0x302e75 of _0x8d6d9a){let _0x2b89e0=_0x490fad;_0x490fad[_0x40b4c2(0x160)]('Country')?(_0x2b89e0=_0x2b89e0[_0x40b4c2(0x14a)](/ip\.sb/g,_0x302e75)['replace'](/Country/g,CONFIG[_0x40b4c2(0x152)]),_0x2b89e0=_0x2b89e0[_0x40b4c2(0x14a)](/\b(443|8443)\b/g,_0x3b852e)):(_0x2b89e0=_0x2b89e0[_0x40b4c2(0x14a)](/YOUXUAN_IP|ip\.sb/g,_0x302e75),_0x2b89e0=_0x2b89e0['replace'](/\b(443|8443)\b/g,_0x3b852e)),_0x2b89e0=_0x2b89e0[_0x40b4c2(0x14a)](/CF_PORT/g,_0x3b852e),(_0x3b852e==='80'||_0x3b852e===_0x40b4c2(0x165))&&(_0x2b89e0=_0x2b89e0[_0x40b4c2(0x14a)](/=tls/g,_0x40b4c2(0x135))['replace'](/tls\",/g,'\x22,')),_0x4c50bc[_0x40b4c2(0x12f)](_0x2b89e0);}}for(const _0xf737d9 of _0x535f4f){if(_0xf737d9[_0x40b4c2(0x160)](_0x40b4c2(0x145)))for(const _0x438c4c of _0x28c21e){let _0x5b2a4a=_0xf737d9[_0x40b4c2(0x14a)](/ip\.sb/g,_0x438c4c['ip'][_0x40b4c2(0x14d)](':')[0x0])[_0x40b4c2(0x14a)](/Country/g,_0x438c4c[_0x40b4c2(0x172)]);const _0x3f6b40=_0x438c4c['ip']['match'](/:(\d+)$/);_0x3f6b40?_0x5b2a4a=_0x5b2a4a[_0x40b4c2(0x14a)](/\b(443|8443)\b/g,_0x3f6b40[0x1]):_0x5b2a4a=_0x5b2a4a['replace'](/\b(443|8443)\b/g,_0x3b852e),_0x5b2a4a=_0x5b2a4a[_0x40b4c2(0x14a)](/CF_PORT/g,_0x3b852e),(_0x3b852e==='80'||_0x3b852e===_0x40b4c2(0x165))&&(_0x5b2a4a=_0x5b2a4a[_0x40b4c2(0x14a)](/=tls/g,_0x40b4c2(0x135))[_0x40b4c2(0x14a)](/tls\",/g,'\x22,')),_0x4c50bc[_0x40b4c2(0x12f)](_0x5b2a4a);}else for(const _0x4d07bb of _0x28c21e){let _0x1ee1cf=_0xf737d9['replace'](/YOUXUAN_IP|ip\.sb/g,_0x4d07bb['ip'][_0x40b4c2(0x14d)](':')[0x0]);const _0x13c745=_0x4d07bb['ip'][_0x40b4c2(0x137)](/:(\d+)$/);_0x13c745?_0x1ee1cf=_0x1ee1cf[_0x40b4c2(0x14a)](/\b(443|8443)\b/g,_0x13c745[0x1]):_0x1ee1cf=_0x1ee1cf[_0x40b4c2(0x14a)](/\b(443|8443)\b/g,_0x3b852e),_0x1ee1cf=_0x1ee1cf['replace'](/CF_PORT/g,_0x3b852e),(_0x3b852e==='80'||_0x3b852e===_0x40b4c2(0x165))&&(_0x1ee1cf=_0x1ee1cf['replace'](/=tls/g,_0x40b4c2(0x135))['replace'](/tls\",/g,'\x22,')),_0x4c50bc[_0x40b4c2(0x12f)](_0x1ee1cf);}}let _0xfde58c=[];for(const _0x4e9bf0 of _0x4c50bc){if(_0x4e9bf0[_0x40b4c2(0x167)]()[_0x40b4c2(0x159)](_0x40b4c2(0x169))||_0x4e9bf0['toLowerCase']()[_0x40b4c2(0x159)]('https://'))try{const _0x383672=await fetch(_0x4e9bf0);let _0x53b089=await _0x383672[_0x40b4c2(0x133)]();try{_0x53b089=atob(_0x53b089);}catch(_0x5a97af){console[_0x40b4c2(0x139)]('订阅内容不是base64编码，使用原始内容');}const _0x587a41=_0x53b089[_0x40b4c2(0x14d)]('\x0a')[_0x40b4c2(0x15f)](_0x56d4c5=>_0x56d4c5['trim']())[_0x40b4c2(0x15f)](_0x35783a=>!shouldExcludeUrl(_0x35783a));_0xfde58c=_0xfde58c[_0x40b4c2(0x148)](_0x587a41);}catch(_0xe6bdb0){console[_0x40b4c2(0x13d)](_0x40b4c2(0x171),_0xe6bdb0);}else _0xfde58c[_0x40b4c2(0x12f)](_0x4e9bf0);}_0xfde58c=_0xfde58c[_0x40b4c2(0x162)](_0x4f62f8=>{const _0x320f52=_0x40b4c2;if(_0x4f62f8[_0x320f52(0x159)](_0x320f52(0x15d))||_0x4f62f8[_0x320f52(0x159)](PROTOCOL['pm']+'ess://')){const _0x1e925a=_0x4f62f8['split']('://')[0x1];if(_0x1e925a&&_0x1e925a[_0x320f52(0x13c)]()['charAt'](0x0)==='{')return PROTOCOL['pm']+'ess://'+btoa(_0x1e925a);}return _0x4f62f8;});const _0x19ee81=btoa(_0xfde58c[_0x40b4c2(0x12e)]('\x0a'));return new Response(_0x19ee81,{'headers':{'Content-Type':_0x40b4c2(0x161)}});}
