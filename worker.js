//设置变量SUB,节点名称设为Country-名称，优选ip设置为ip.sb,会自动替换国家和优选
//设置变量API为优选ip获取地址
//订阅链接格式:域名/token=值?cf_port=值
//以下是我找到的优选ip的api地址，你也可以搭建自己的api
//https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestproxy.txt
//https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestcf.txt
//https://ip.164746.xyz/ipTop10.html
//https://vps789.com/public/sum/cfIpApi
//https://www.wetest.vip/api/cf2dns/get_cloudflare_ip&type=v4&key=o1zrmHAF
//https://raw.githubusercontent.com/cmliu/WorkerVless2sub/main/addressesapi.txt
//https://addressesapi.090227.xyz/CloudFlareYes
const CONFIG = {
    TOKEN: '111',  //订阅链接密钥
    API: 'https://vps789.com/public/sum/cfIpApi',  //优选ip的api,多个用;隔开
    SUB: '',  //自定义链接,多个用;隔开
    CFIPS: 'ip.sb;bestcf.030101.xyz' ,//优选域名,多个用;隔开
    COUNTRY_REPLACE: 'YM' // 优选域名节点国家的拼音简称
};
//排除包含关键词的节点
const excludeKeywords = 'GB-eu.com;TW-free.tw';

(function(_0x3c336f,_0x5a4221){const _0x10b0a6=_0x5217,_0x470bbe=_0x3c336f();while(!![]){try{const _0x52fcd0=parseInt(_0x10b0a6(0x1cd))/0x1*(parseInt(_0x10b0a6(0x1a4))/0x2)+-parseInt(_0x10b0a6(0x1e6))/0x3+parseInt(_0x10b0a6(0x1b2))/0x4+-parseInt(_0x10b0a6(0x1e5))/0x5*(-parseInt(_0x10b0a6(0x1cf))/0x6)+-parseInt(_0x10b0a6(0x1de))/0x7*(parseInt(_0x10b0a6(0x1c1))/0x8)+parseInt(_0x10b0a6(0x1c2))/0x9*(-parseInt(_0x10b0a6(0x1be))/0xa)+parseInt(_0x10b0a6(0x1b4))/0xb*(parseInt(_0x10b0a6(0x1e3))/0xc);if(_0x52fcd0===_0x5a4221)break;else _0x470bbe['push'](_0x470bbe['shift']());}catch(_0x508b9b){_0x470bbe['push'](_0x470bbe['shift']());}}}(_0x43ae,0xc02ed));const PROTOCOL={'xieyi':'vl','xieyi2':'ess','pm':'vm'};function preProcessUrl(_0x1b5649){const _0x55fecf=_0x5217,_0x449782=(_0x1b5649['startsWith'](_0x55fecf(0x1cb))||_0x1b5649[_0x55fecf(0x1b9)](PROTOCOL['pm']+'ess://'))&&_0x1b5649[_0x55fecf(0x1d5)](_0x55fecf(0x1ae))[0x1][_0x55fecf(0x1ce)](0x0)!=='{';if(_0x449782){const _0x5b714a=atob(_0x1b5649['split'](_0x55fecf(0x1ae))[0x1]);return PROTOCOL['pm']+_0x55fecf(0x1d1)+_0x5b714a[_0x55fecf(0x1a7)](/\{PASS\}\-/g,'')[_0x55fecf(0x1a7)](/\{PA/g,PROTOCOL[_0x55fecf(0x1c3)])[_0x55fecf(0x1a7)](/SS\}/g,PROTOCOL[_0x55fecf(0x1bb)])[_0x55fecf(0x1a7)](/\{BA/g,PROTOCOL['pm']);}return _0x1b5649[_0x55fecf(0x1a7)](/\{PASS\}\-/g,'')[_0x55fecf(0x1a7)](/\{PA/g,PROTOCOL['xieyi'])[_0x55fecf(0x1a7)](/SS\}/g,PROTOCOL[_0x55fecf(0x1bb)])[_0x55fecf(0x1a7)](/\{BA/g,PROTOCOL['pm']);}function shouldExcludeUrl(_0xe46d08){const _0x366e2a=_0x5217;return excludeKeywords['split'](';')[_0x366e2a(0x1a9)](_0x117dba=>_0x117dba[_0x366e2a(0x1b3)]())['some'](_0xd1fe22=>_0xe46d08[_0x366e2a(0x1d2)](_0xd1fe22));}function getSubUrls(_0x1d5819,_0x536d84){const _0x27c34e=_0x5217,_0x155fb6=_0x536d84[_0x27c34e(0x1af)](_0x27c34e(0x1a2));if(_0x155fb6)return _0x155fb6[_0x27c34e(0x1d5)](';')[_0x27c34e(0x1a9)](_0x5a0833=>_0x5a0833[_0x27c34e(0x1b3)]())[_0x27c34e(0x1a9)](_0x8d1af3=>preProcessUrl(_0x8d1af3))[_0x27c34e(0x1c9)](_0x4ab9bd=>typeof _0x4ab9bd===_0x27c34e(0x1b8)&&!shouldExcludeUrl(_0x4ab9bd));return(_0x1d5819['SUB']||'')[_0x27c34e(0x1d5)](';')['map'](_0xa3dbc5=>_0xa3dbc5[_0x27c34e(0x1b3)]())['map'](_0x2e65d4=>preProcessUrl(_0x2e65d4))[_0x27c34e(0x1c9)](_0x53fc2c=>typeof _0x53fc2c==='string'&&!shouldExcludeUrl(_0x53fc2c));}function _0x43ae(){const _0x356f22=['sub','warn','8yHFXDT','Hello\x20World','forEach','replace','push','map','HTTP\x20Error\x20for\x20','json','error','content-type','://','get','API','isArray','2961708FLbQQW','trim','4734169spXSbr','Not\x20Found','No\x20valid\x20IP\x20data\x20found\x20from\x20any\x20API\x20endpoints','toLowerCase','string','startsWith','match','xieyi2','Error\x20fetching\x20data\x20from\x20','No\x20API\x20endpoints\x20provided','10coIAOR','https://','Error\x20processing\x20IP\x20data','5751728txMEgz','6956289eizTSl','xieyi','some','unknown','No\x20valid\x20IP\x20data\x20found','all','COUNTRY_REPLACE','filter','处理订阅链接失败:','{BASS}://','CFIPS','255083PKDqFU','charAt','6006XcMytc','object','ess://','includes','/token=','text','split','Error\x20parsing\x20JSON','country','length','trimStart','cf_port','8080','Country','=none','14andLus','https://ipinfo.io/','pathname','Error\x20fetching\x20country\x20for\x20IP\x20','text/plain','36paMNXa','parse','6595zpLCZG','4122543xOEcyu','http://','url','status','Error\x20fetching\x20or\x20processing\x20data','Missing\x20cf_port','join'];_0x43ae=function(){return _0x356f22;};return _0x43ae();}function _0x5217(_0x59b3e4,_0x3cba2d){const _0x43ae58=_0x43ae();return _0x5217=function(_0x521725,_0xc4e649){_0x521725=_0x521725-0x19d;let _0x2d121e=_0x43ae58[_0x521725];return _0x2d121e;},_0x5217(_0x59b3e4,_0x3cba2d);}async function extractIpsFromResponse(_0x1f0e3d){const _0x1263e1=_0x5217;let _0x5c22c9=[];const _0x4c6bc1=_0x1f0e3d['headers'][_0x1263e1(0x1af)](_0x1263e1(0x1ad));let _0x29f4f9;try{_0x29f4f9=await _0x1f0e3d[_0x1263e1(0x1d4)]();if(_0x4c6bc1&&_0x4c6bc1[_0x1263e1(0x1d2)]('application/json'))try{_0x29f4f9=JSON[_0x1263e1(0x1e4)](_0x29f4f9);const _0x55ece4=_0x26f302=>{const _0x4bde23=_0x1263e1;if(typeof _0x26f302===_0x4bde23(0x1b8)){const _0xda00d9=_0x26f302[_0x4bde23(0x1ba)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/);_0xda00d9&&_0x5c22c9[_0x4bde23(0x1a8)](_0xda00d9[0x0]['trim']());}else{if(Array[_0x4bde23(0x1b1)](_0x26f302))_0x26f302[_0x4bde23(0x1a6)](_0x2449d9=>{const _0x394474=_0x4bde23;if(typeof _0x2449d9===_0x394474(0x1b8)){const _0x481e18=_0x2449d9[_0x394474(0x1ba)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/);_0x481e18&&_0x5c22c9[_0x394474(0x1a8)](_0x481e18[0x0][_0x394474(0x1b3)]());}else typeof _0x2449d9===_0x394474(0x1d0)&&_0x55ece4(_0x2449d9);});else{if(typeof _0x26f302===_0x4bde23(0x1d0)&&_0x26f302!==null)for(const _0x192272 in _0x26f302){_0x26f302['hasOwnProperty'](_0x192272)&&_0x55ece4(_0x26f302[_0x192272]);}}}};_0x55ece4(_0x29f4f9);}catch(_0x1bfd48){console['error'](_0x1263e1(0x1d6),_0x1bfd48);const _0x8a4c13=_0x29f4f9[_0x1263e1(0x1ba)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/gm)||[];_0x5c22c9[_0x1263e1(0x1a8)](..._0x8a4c13);}else{const _0x43ce93=_0x29f4f9[_0x1263e1(0x1ba)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/gm)||[];_0x5c22c9[_0x1263e1(0x1a8)](..._0x43ce93);}}catch(_0x58289a){console[_0x1263e1(0x1ac)](_0x1263e1(0x19f),_0x58289a);}return[...new Set(_0x5c22c9)][_0x1263e1(0x1c9)](Boolean);}export default{async 'fetch'(_0x4a206a,_0x4c8c17){const _0x1f7d53=_0x5217,_0x415834=new URL(_0x4a206a[_0x1f7d53(0x19d)]);if(_0x415834[_0x1f7d53(0x1e0)]==='/'||_0x415834[_0x1f7d53(0x1e0)]==='')return new Response(_0x1f7d53(0x1a5),{'headers':{'content-type':'text/plain'}});if(_0x415834[_0x1f7d53(0x1e0)]===_0x1f7d53(0x1d3)+CONFIG['TOKEN'])return handleToken(_0x4a206a,_0x4c8c17);return new Response(_0x1f7d53(0x1b5),{'status':0x194});}};async function handleToken(_0x3ac662,_0xaeeddc){const _0x19a00b=_0x5217,_0x1f00dd=new URL(_0x3ac662[_0x19a00b(0x19d)])['searchParams'],_0x3b4e88=_0x1f00dd[_0x19a00b(0x1af)](_0x19a00b(0x1da));if(!_0x3b4e88)return new Response(_0x19a00b(0x1a0),{'status':0x190});let _0x54fd29=[],_0xde5d43=[];const _0x4c38b4=_0xaeeddc[_0x19a00b(0x1b0)];_0x4c38b4&&(_0xde5d43=_0x4c38b4['split'](';')[_0x19a00b(0x1a9)](_0x140b31=>_0x140b31[_0x19a00b(0x1b3)]())['filter'](Boolean));_0xde5d43[_0x19a00b(0x1d8)]===0x0&&(_0xde5d43=(CONFIG[_0x19a00b(0x1b0)]||'')[_0x19a00b(0x1d5)](';')[_0x19a00b(0x1a9)](_0x31797f=>_0x31797f[_0x19a00b(0x1b3)]())['filter'](Boolean));if(_0xde5d43[_0x19a00b(0x1d8)]===0x0)return new Response(_0x19a00b(0x1bd),{'status':0x190});try{let _0xe59aad=[];for(const _0x301a74 of _0xde5d43){try{const _0x2bd132=await fetch(_0x301a74);if(!_0x2bd132['ok']){console[_0x19a00b(0x1ac)](_0x19a00b(0x1aa)+_0x301a74+':\x20'+_0x2bd132[_0x19a00b(0x19e)]);continue;}const _0x2b7403=await extractIpsFromResponse(_0x2bd132);_0xe59aad['push'](..._0x2b7403);}catch(_0x15a260){console['error'](_0x19a00b(0x1bc)+_0x301a74+':',_0x15a260);}}if(_0xe59aad[_0x19a00b(0x1d8)]===0x0)return new Response(_0x19a00b(0x1b6),{'status':0x190});const _0x50a06a=[...new Set(_0xe59aad)][_0x19a00b(0x1c9)](Boolean);_0x54fd29=await Promise[_0x19a00b(0x1c7)](_0x50a06a['map'](async _0x1fb0b9=>{const _0x281401=_0x19a00b;try{const _0x3c42e6=await fetch(_0x281401(0x1df)+_0x1fb0b9[_0x281401(0x1d5)](':')[0x0]+'/json');if(!_0x3c42e6['ok'])return console[_0x281401(0x1a3)](_0x281401(0x1e1)+_0x1fb0b9+':\x20'+_0x3c42e6[_0x281401(0x19e)]),{'ip':_0x1fb0b9,'country':_0x281401(0x1c5)};return{'ip':_0x1fb0b9,'country':(await _0x3c42e6[_0x281401(0x1ab)]())[_0x281401(0x1d7)]||_0x281401(0x1c5)};}catch(_0x58bc4e){return console['warn'](_0x281401(0x1e1)+_0x1fb0b9+':\x20'+_0x58bc4e),{'ip':_0x1fb0b9,'country':_0x281401(0x1c5)};}}));if(_0x54fd29[_0x19a00b(0x1d8)]===0x0)return new Response(_0x19a00b(0x1c6),{'status':0x190});}catch(_0x471f62){return console['error']('Error\x20fetching\x20or\x20processing\x20IP\x20data:',_0x471f62),new Response(_0x19a00b(0x1c0),{'status':0x1f4});}let _0x34a21b=getSubUrls(_0xaeeddc,_0x1f00dd);const _0x47c4d8=_0x34a21b[_0x19a00b(0x1c9)](_0x4215b9=>!excludeKeywords[_0x19a00b(0x1d5)](';')[_0x19a00b(0x1a9)](_0x1d4c79=>_0x1d4c79[_0x19a00b(0x1b3)]())[_0x19a00b(0x1c4)](_0x41db89=>_0x4215b9['includes'](_0x41db89)));let _0x17b35f=[],_0x2a9f26=[];const _0x1b06f7=_0x1f00dd[_0x19a00b(0x1af)]('cfips');_0x1b06f7?_0x2a9f26=_0x1b06f7[_0x19a00b(0x1d5)](';')[_0x19a00b(0x1a9)](_0x19739d=>_0x19739d['trim']())[_0x19a00b(0x1c9)](Boolean):_0x2a9f26=(CONFIG[_0x19a00b(0x1cc)]||'')[_0x19a00b(0x1d5)](';')[_0x19a00b(0x1a9)](_0x53a004=>_0x53a004[_0x19a00b(0x1b3)]())['filter'](Boolean);for(const _0xb0475a of _0x47c4d8){for(const _0x112832 of _0x2a9f26){let _0x5cb0c2=_0xb0475a;_0xb0475a[_0x19a00b(0x1d2)]('Country')?(_0x5cb0c2=_0x5cb0c2['replace'](/ip\.sb/g,_0x112832)[_0x19a00b(0x1a7)](/Country/g,CONFIG[_0x19a00b(0x1c8)]),_0x5cb0c2=_0x5cb0c2['replace'](/\b(443|8443)\b/g,_0x3b4e88)):(_0x5cb0c2=_0x5cb0c2[_0x19a00b(0x1a7)](/YOUXUAN_IP|ip\.sb/g,_0x112832),_0x5cb0c2=_0x5cb0c2['replace'](/\b(443|8443)\b/g,_0x3b4e88)),_0x5cb0c2=_0x5cb0c2['replace'](/CF_PORT/g,_0x3b4e88),(_0x3b4e88==='80'||_0x3b4e88===_0x19a00b(0x1db))&&(_0x5cb0c2=_0x5cb0c2[_0x19a00b(0x1a7)](/=tls/g,_0x19a00b(0x1dd))['replace'](/tls\",/g,'\x22,')),_0x17b35f[_0x19a00b(0x1a8)](_0x5cb0c2);}}for(const _0xa79fe0 of _0x47c4d8){if(_0xa79fe0[_0x19a00b(0x1d2)](_0x19a00b(0x1dc)))for(const _0x382466 of _0x54fd29){let _0x18dec7=_0xa79fe0['replace'](/ip\.sb/g,_0x382466['ip'][_0x19a00b(0x1d5)](':')[0x0])[_0x19a00b(0x1a7)](/Country/g,_0x382466[_0x19a00b(0x1d7)]);const _0x50b95b=_0x382466['ip'][_0x19a00b(0x1ba)](/:(\d+)$/);_0x50b95b?_0x18dec7=_0x18dec7[_0x19a00b(0x1a7)](/\b(443|8443)\b/g,_0x50b95b[0x1]):_0x18dec7=_0x18dec7[_0x19a00b(0x1a7)](/\b(443|8443)\b/g,_0x3b4e88),_0x18dec7=_0x18dec7['replace'](/CF_PORT/g,_0x3b4e88),(_0x3b4e88==='80'||_0x3b4e88===_0x19a00b(0x1db))&&(_0x18dec7=_0x18dec7[_0x19a00b(0x1a7)](/=tls/g,'=none')[_0x19a00b(0x1a7)](/tls\",/g,'\x22,')),_0x17b35f[_0x19a00b(0x1a8)](_0x18dec7);}else for(const _0x377ad3 of _0x54fd29){let _0xd8f20c=_0xa79fe0[_0x19a00b(0x1a7)](/YOUXUAN_IP|ip\.sb/g,_0x377ad3['ip']['split'](':')[0x0]);const _0x112af9=_0x377ad3['ip'][_0x19a00b(0x1ba)](/:(\d+)$/);_0x112af9?_0xd8f20c=_0xd8f20c[_0x19a00b(0x1a7)](/\b(443|8443)\b/g,_0x112af9[0x1]):_0xd8f20c=_0xd8f20c[_0x19a00b(0x1a7)](/\b(443|8443)\b/g,_0x3b4e88),_0xd8f20c=_0xd8f20c[_0x19a00b(0x1a7)](/CF_PORT/g,_0x3b4e88),(_0x3b4e88==='80'||_0x3b4e88===_0x19a00b(0x1db))&&(_0xd8f20c=_0xd8f20c[_0x19a00b(0x1a7)](/=tls/g,_0x19a00b(0x1dd))[_0x19a00b(0x1a7)](/tls\",/g,'\x22,')),_0x17b35f[_0x19a00b(0x1a8)](_0xd8f20c);}}let _0x58bcf2=[];for(const _0xaa1f5b of _0x17b35f){if(_0xaa1f5b[_0x19a00b(0x1b7)]()[_0x19a00b(0x1b9)](_0x19a00b(0x1e7))||_0xaa1f5b[_0x19a00b(0x1b7)]()[_0x19a00b(0x1b9)](_0x19a00b(0x1bf)))try{const _0x1bb2a1=await fetch(_0xaa1f5b);let _0x2687a8=await _0x1bb2a1['text']();try{_0x2687a8=atob(_0x2687a8);}catch(_0x4d15a5){console['log']('订阅内容不是base64编码，使用原始内容');}const _0x1d1a15=_0x2687a8[_0x19a00b(0x1d5)]('\x0a')[_0x19a00b(0x1c9)](_0x491c79=>_0x491c79[_0x19a00b(0x1b3)]())[_0x19a00b(0x1c9)](_0x15456a=>!shouldExcludeUrl(_0x15456a));_0x58bcf2=_0x58bcf2['concat'](_0x1d1a15);}catch(_0x4be642){console[_0x19a00b(0x1ac)](_0x19a00b(0x1ca),_0x4be642);}else _0x58bcf2['push'](_0xaa1f5b);}_0x58bcf2=_0x58bcf2[_0x19a00b(0x1a9)](_0x437029=>{const _0x554c25=_0x19a00b;if(_0x437029[_0x554c25(0x1b9)](_0x554c25(0x1cb))||_0x437029[_0x554c25(0x1b9)](PROTOCOL['pm']+_0x554c25(0x1d1))){const _0x3cd0ac=_0x437029[_0x554c25(0x1d5)](_0x554c25(0x1ae))[0x1];if(_0x3cd0ac&&_0x3cd0ac[_0x554c25(0x1d9)]()['charAt'](0x0)==='{')return PROTOCOL['pm']+_0x554c25(0x1d1)+btoa(_0x3cd0ac);}return _0x437029;});const _0x25bc02=btoa(_0x58bcf2[_0x19a00b(0x1a1)]('\x0a'));return new Response(_0x25bc02,{'headers':{'Content-Type':_0x19a00b(0x1e2)}});}