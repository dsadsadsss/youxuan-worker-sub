//设置变量SUB,节点名称设为Country-名称，优选ip设置为ip.sb,会自动替换国家和优选
//订阅链接格式:域名/token=值?cf_port=值
//https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestproxy.txt
//https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestcf.txt
//https://ip.164746.xyz/ipTop10.html;https://vps789.com/public/sum/cfIpApi;https://www.wetest.vip/api/cf2dns/get_cloudflare_ip&type=v4&key=o1zrmHAF
//https://raw.githubusercontent.com/cmliu/WorkerVless2sub/main/addressesapi.txt
//https://addressesapi.090227.xyz/CloudFlareYes
const CONFIG = {
    TOKEN: '111',  //订阅链接密钥
    API: 'https://ip.164746.xyz/ipTop10.html;https://addressesapi.090227.xyz/CloudFlareYes;https://raw.githubusercontent.com/cmliu/WorkerVless2sub/main/addressesapi.txt;https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestproxy.txt;https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestcf.txt',  //优选ip的api,多个用;隔开
    SUB: '',  //自定义链接,多个用;隔开
    CFIPS: 'ip.sb;bestcf.030101.xyz' ,//优选域名,多个用;隔开
    COUNTRY_REPLACE: 'YM' // 域名的简称
};
//排除包含关键词的节点
const excludeKeywords = 'GB-eu.com;TW-free.tw';
function _0x5ad5(_0x37d044,_0x1f3e8b){const _0x42a038=_0x42a0();return _0x5ad5=function(_0x5ad580,_0x85e76e){_0x5ad580=_0x5ad580-0x1d3;let _0xf0345=_0x42a038[_0x5ad580];return _0xf0345;},_0x5ad5(_0x37d044,_0x1f3e8b);}const _0x5a0b84=_0x5ad5;(function(_0xa0e32b,_0x494ca5){const _0x5e1a07=_0x5ad5,_0x5d7f63=_0xa0e32b();while(!![]){try{const _0x312305=-parseInt(_0x5e1a07(0x1db))/0x1+-parseInt(_0x5e1a07(0x1f7))/0x2*(parseInt(_0x5e1a07(0x1e1))/0x3)+-parseInt(_0x5e1a07(0x20b))/0x4*(parseInt(_0x5e1a07(0x202))/0x5)+-parseInt(_0x5e1a07(0x214))/0x6+parseInt(_0x5e1a07(0x1fc))/0x7*(-parseInt(_0x5e1a07(0x219))/0x8)+-parseInt(_0x5e1a07(0x1e8))/0x9*(parseInt(_0x5e1a07(0x209))/0xa)+-parseInt(_0x5e1a07(0x1f1))/0xb*(-parseInt(_0x5e1a07(0x20f))/0xc);if(_0x312305===_0x494ca5)break;else _0x5d7f63['push'](_0x5d7f63['shift']());}catch(_0x9d67c9){_0x5d7f63['push'](_0x5d7f63['shift']());}}}(_0x42a0,0x8d476));const PROTOCOL={'xieyi':'vl','xieyi2':_0x5a0b84(0x201),'pm':'vm'};function _0x42a0(){const _0x53128d=['CFIPS','=none','15wciNlj','http://','push','concat','string','COUNTRY_REPLACE','map','9leBxdZ','log','Error\x20fetching\x20data\x20from\x20','8080','filter','application/json','includes','text/plain','split','11GPpiFH','some','No\x20valid\x20IP\x20data\x20found\x20from\x20any\x20API\x20endpoints','replace','trimStart','length','377444WCHLOq','toLowerCase','Error\x20fetching\x20or\x20processing\x20IP\x20data:','startsWith','No\x20valid\x20IP\x20data\x20found','3947923FRgAIM','match','error','charAt','https://ipinfo.io/','ess','1429945KcyGTp','trim','get','country','/token=','unknown','content-type','2772890gwyOuZ','hasOwnProperty','8oZvtxf','text','status','SUB','48556236iRAKHP','Missing\x20cf_port','Country','{BASS}://','订阅内容不是base64编码，使用原始内容','2664390FmODyv','cf_port','xieyi','url','join','8kgjErz','Error\x20processing\x20IP\x20data','ess://','forEach','warn','object','pathname','Error\x20fetching\x20or\x20processing\x20data','API','No\x20API\x20endpoints\x20provided','json','666744pBKClC','HTTP\x20Error\x20for\x20','Error\x20fetching\x20country\x20for\x20IP\x20','://'];_0x42a0=function(){return _0x53128d;};return _0x42a0();}function preProcessUrl(_0x4e5edb){const _0x490128=_0x5a0b84,_0x3f2e79=(_0x4e5edb[_0x490128(0x1fa)]('{BASS}://')||_0x4e5edb[_0x490128(0x1fa)](PROTOCOL['pm']+'ess://'))&&_0x4e5edb[_0x490128(0x1f0)](_0x490128(0x1de))[0x1][_0x490128(0x1ff)](0x0)!=='{';if(_0x3f2e79){const _0x133457=atob(_0x4e5edb[_0x490128(0x1f0)](_0x490128(0x1de))[0x1]);return PROTOCOL['pm']+_0x490128(0x21b)+_0x133457['replace'](/\{PASS\}\-/g,'')[_0x490128(0x1f4)](/\{PA/g,PROTOCOL[_0x490128(0x216)])['replace'](/SS\}/g,PROTOCOL['xieyi2'])[_0x490128(0x1f4)](/\{BA/g,PROTOCOL['pm']);}return _0x4e5edb[_0x490128(0x1f4)](/\{PASS\}\-/g,'')[_0x490128(0x1f4)](/\{PA/g,PROTOCOL['xieyi'])[_0x490128(0x1f4)](/SS\}/g,PROTOCOL['xieyi2'])[_0x490128(0x1f4)](/\{BA/g,PROTOCOL['pm']);}function shouldExcludeUrl(_0x184455){const _0x23b2e6=_0x5a0b84;return excludeKeywords[_0x23b2e6(0x1f0)](';')[_0x23b2e6(0x1e7)](_0x5adb8a=>_0x5adb8a[_0x23b2e6(0x203)]())['some'](_0x5e64c7=>_0x184455[_0x23b2e6(0x1ee)](_0x5e64c7));}function getSubUrls(_0x24dd54){const _0x3cb899=_0x5a0b84;return(_0x24dd54[_0x3cb899(0x20e)]||'')[_0x3cb899(0x1f0)](';')[_0x3cb899(0x1e7)](_0x377cf3=>_0x377cf3['trim']())[_0x3cb899(0x1e7)](_0x46ad0e=>preProcessUrl(_0x46ad0e))[_0x3cb899(0x1ec)](_0x5b5385=>typeof _0x5b5385===_0x3cb899(0x1e5)&&!shouldExcludeUrl(_0x5b5385));}async function extractIpsFromResponse(_0x40dfbd){const _0x3b6a19=_0x5a0b84;let _0x3f5f86=[];const _0x4dca47=_0x40dfbd['headers'][_0x3b6a19(0x204)](_0x3b6a19(0x208));let _0x33b96d;try{_0x33b96d=await _0x40dfbd[_0x3b6a19(0x20c)]();if(_0x4dca47&&_0x4dca47[_0x3b6a19(0x1ee)](_0x3b6a19(0x1ed)))try{_0x33b96d=JSON['parse'](_0x33b96d);const _0x23e811=_0x13e17c=>{const _0x35c226=_0x3b6a19;if(typeof _0x13e17c===_0x35c226(0x1e5)&&_0x13e17c[_0x35c226(0x1fd)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?$/))_0x3f5f86['push'](_0x13e17c[_0x35c226(0x203)]());else{if(Array['isArray'](_0x13e17c))_0x13e17c[_0x35c226(0x1d3)](_0x1f9673=>{const _0x483972=_0x35c226;if(typeof _0x1f9673===_0x483972(0x1d5))_0x23e811(_0x1f9673);else typeof _0x1f9673===_0x483972(0x1e5)&&_0x1f9673['match'](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?$/)&&_0x3f5f86[_0x483972(0x1e3)](_0x1f9673[_0x483972(0x203)]());});else{if(typeof _0x13e17c===_0x35c226(0x1d5)&&_0x13e17c!==null)for(const _0x209a98 in _0x13e17c){_0x13e17c[_0x35c226(0x20a)](_0x209a98)&&_0x23e811(_0x13e17c[_0x209a98]);}}}};_0x23e811(_0x33b96d);}catch(_0xd103aa){console[_0x3b6a19(0x1fe)]('Error\x20parsing\x20JSON',_0xd103aa);const _0x49cc23=_0x33b96d['match'](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?$/gm)||[];_0x3f5f86[_0x3b6a19(0x1e3)](..._0x49cc23);}else{const _0x177956=_0x33b96d[_0x3b6a19(0x1fd)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?$/gm)||[];_0x3f5f86['push'](..._0x177956);}}catch(_0x169ff1){console[_0x3b6a19(0x1fe)](_0x3b6a19(0x1d7),_0x169ff1);}return[...new Set(_0x3f5f86)]['filter'](Boolean);}export default{async 'fetch'(_0x3ca3a9,_0x373848){const _0x1cc415=_0x5a0b84,_0x55ad50=new URL(_0x3ca3a9[_0x1cc415(0x217)]);if(_0x55ad50['pathname']==='/'||_0x55ad50[_0x1cc415(0x1d6)]==='')return new Response('Hello\x20World',{'headers':{'content-type':_0x1cc415(0x1ef)}});if(_0x55ad50['pathname']===_0x1cc415(0x206)+CONFIG['TOKEN'])return handleToken(_0x3ca3a9,_0x373848);return new Response('Not\x20Found',{'status':0x194});}};async function handleToken(_0x3f419e,_0x4ecb37){const _0x357f63=_0x5a0b84,_0x4c7951=new URL(_0x3f419e[_0x357f63(0x217)])['searchParams']['get'](_0x357f63(0x215));if(!_0x4c7951)return new Response(_0x357f63(0x210),{'status':0x190});let _0x21e897=[];const _0x153e47=(CONFIG[_0x357f63(0x1d8)]||'')['split'](';')[_0x357f63(0x1e7)](_0x251c09=>_0x251c09['trim']())['filter'](Boolean);if(_0x153e47['length']===0x0)return new Response(_0x357f63(0x1d9),{'status':0x190});try{let _0x4da0c3=[];for(const _0x4a94e6 of _0x153e47){try{const _0x5da23c=await fetch(_0x4a94e6);if(!_0x5da23c['ok']){console[_0x357f63(0x1fe)](_0x357f63(0x1dc)+_0x4a94e6+':\x20'+_0x5da23c['status']);continue;}const _0x35ff38=await extractIpsFromResponse(_0x5da23c);_0x4da0c3[_0x357f63(0x1e3)](..._0x35ff38);}catch(_0x490689){console[_0x357f63(0x1fe)](_0x357f63(0x1ea)+_0x4a94e6+':',_0x490689);}}if(_0x4da0c3[_0x357f63(0x1f6)]===0x0)return new Response(_0x357f63(0x1f3),{'status':0x190});const _0x1dfe56=[...new Set(_0x4da0c3)][_0x357f63(0x1ec)](Boolean);_0x21e897=await Promise['all'](_0x1dfe56[_0x357f63(0x1e7)](async _0x3b4965=>{const _0x1778eb=_0x357f63;try{const _0x41a461=await fetch(_0x1778eb(0x200)+_0x3b4965['split'](':')[0x0]+'/json');if(!_0x41a461['ok'])return console['warn'](_0x1778eb(0x1dd)+_0x3b4965+':\x20'+_0x41a461[_0x1778eb(0x20d)]),{'ip':_0x3b4965,'country':'unknown'};return{'ip':_0x3b4965,'country':(await _0x41a461[_0x1778eb(0x1da)]())['country']||_0x1778eb(0x207)};}catch(_0x15e0d6){return console[_0x1778eb(0x1d4)](_0x1778eb(0x1dd)+_0x3b4965+':\x20'+_0x15e0d6),{'ip':_0x3b4965,'country':_0x1778eb(0x207)};}}));if(_0x21e897['length']===0x0)return new Response(_0x357f63(0x1fb),{'status':0x190});}catch(_0x3445bc){return console[_0x357f63(0x1fe)](_0x357f63(0x1f9),_0x3445bc),new Response(_0x357f63(0x21a),{'status':0x1f4});}let _0x444db4=getSubUrls(_0x4ecb37);const _0x5414c8=_0x444db4['filter'](_0x3859d6=>!excludeKeywords['split'](';')['map'](_0x39b078=>_0x39b078[_0x357f63(0x203)]())[_0x357f63(0x1f2)](_0x57cbf6=>_0x3859d6[_0x357f63(0x1ee)](_0x57cbf6)));let _0xb58580=[];const _0x548e82=(CONFIG[_0x357f63(0x1df)]||'')['split'](';')['map'](_0x5d8fab=>_0x5d8fab[_0x357f63(0x203)]())[_0x357f63(0x1ec)](Boolean);for(const _0x4d5772 of _0x5414c8){for(const _0x1b50e1 of _0x548e82){let _0x283d7d=_0x4d5772;_0x4d5772[_0x357f63(0x1ee)](_0x357f63(0x211))?(_0x283d7d=_0x283d7d[_0x357f63(0x1f4)](/ip\.sb/g,_0x1b50e1)[_0x357f63(0x1f4)](/Country/g,CONFIG[_0x357f63(0x1e6)]),_0x283d7d=_0x283d7d[_0x357f63(0x1f4)](/\b(443|8443)\b/g,_0x4c7951)):(_0x283d7d=_0x283d7d['replace'](/YOUXUAN_IP|ip\.sb/g,_0x1b50e1),_0x283d7d=_0x283d7d[_0x357f63(0x1f4)](/\b(443|8443)\b/g,_0x4c7951)),_0x283d7d=_0x283d7d[_0x357f63(0x1f4)](/CF_PORT/g,_0x4c7951),(_0x4c7951==='80'||_0x4c7951===_0x357f63(0x1eb))&&(_0x283d7d=_0x283d7d['replace'](/=tls/g,_0x357f63(0x1e0))[_0x357f63(0x1f4)](/tls\",/g,'\x22,')),_0xb58580[_0x357f63(0x1e3)](_0x283d7d);}}for(const _0x266443 of _0x5414c8){if(_0x266443[_0x357f63(0x1ee)](_0x357f63(0x211)))for(const _0x397dba of _0x21e897){let _0x2eb7dc=_0x266443[_0x357f63(0x1f4)](/ip\.sb/g,_0x397dba['ip'][_0x357f63(0x1f0)](':')[0x0])[_0x357f63(0x1f4)](/Country/g,_0x397dba[_0x357f63(0x205)]);const _0x258055=_0x397dba['ip'][_0x357f63(0x1fd)](/:(\d+)$/);_0x258055?_0x2eb7dc=_0x2eb7dc[_0x357f63(0x1f4)](/\b(443|8443)\b/g,_0x258055[0x1]):_0x2eb7dc=_0x2eb7dc[_0x357f63(0x1f4)](/\b(443|8443)\b/g,_0x4c7951),_0x2eb7dc=_0x2eb7dc[_0x357f63(0x1f4)](/CF_PORT/g,_0x4c7951),(_0x4c7951==='80'||_0x4c7951===_0x357f63(0x1eb))&&(_0x2eb7dc=_0x2eb7dc[_0x357f63(0x1f4)](/=tls/g,_0x357f63(0x1e0))['replace'](/tls\",/g,'\x22,')),_0xb58580[_0x357f63(0x1e3)](_0x2eb7dc);}else for(const _0x4d2110 of _0x21e897){let _0x20d256=_0x266443[_0x357f63(0x1f4)](/YOUXUAN_IP|ip\.sb/g,_0x4d2110['ip']['split'](':')[0x0]);const _0x3f0a46=_0x4d2110['ip'][_0x357f63(0x1fd)](/:(\d+)$/);_0x3f0a46?_0x20d256=_0x20d256[_0x357f63(0x1f4)](/\b(443|8443)\b/g,_0x3f0a46[0x1]):_0x20d256=_0x20d256[_0x357f63(0x1f4)](/\b(443|8443)\b/g,_0x4c7951),_0x20d256=_0x20d256[_0x357f63(0x1f4)](/CF_PORT/g,_0x4c7951),(_0x4c7951==='80'||_0x4c7951==='8080')&&(_0x20d256=_0x20d256[_0x357f63(0x1f4)](/=tls/g,'=none')[_0x357f63(0x1f4)](/tls\",/g,'\x22,')),_0xb58580[_0x357f63(0x1e3)](_0x20d256);}}let _0x3ffc93=[];for(const _0xf2e6f7 of _0xb58580){if(_0xf2e6f7['toLowerCase']()[_0x357f63(0x1fa)](_0x357f63(0x1e2))||_0xf2e6f7[_0x357f63(0x1f8)]()[_0x357f63(0x1fa)]('https://'))try{const _0xf8a979=await fetch(_0xf2e6f7);let _0x572a89=await _0xf8a979[_0x357f63(0x20c)]();try{_0x572a89=atob(_0x572a89);}catch(_0x5efbdd){console[_0x357f63(0x1e9)](_0x357f63(0x213));}const _0x334bf3=_0x572a89[_0x357f63(0x1f0)]('\x0a')[_0x357f63(0x1ec)](_0x1e7ff1=>_0x1e7ff1['trim']())['filter'](_0x36ee84=>!shouldExcludeUrl(_0x36ee84));_0x3ffc93=_0x3ffc93[_0x357f63(0x1e4)](_0x334bf3);}catch(_0x9df1d1){console['error']('处理订阅链接失败:',_0x9df1d1);}else _0x3ffc93[_0x357f63(0x1e3)](_0xf2e6f7);}_0x3ffc93=_0x3ffc93[_0x357f63(0x1e7)](_0x13bdaf=>{const _0x5f0ec5=_0x357f63;if(_0x13bdaf[_0x5f0ec5(0x1fa)](_0x5f0ec5(0x212))||_0x13bdaf[_0x5f0ec5(0x1fa)](PROTOCOL['pm']+_0x5f0ec5(0x21b))){const _0x20e5a9=_0x13bdaf[_0x5f0ec5(0x1f0)](_0x5f0ec5(0x1de))[0x1];if(_0x20e5a9&&_0x20e5a9[_0x5f0ec5(0x1f5)]()[_0x5f0ec5(0x1ff)](0x0)==='{')return PROTOCOL['pm']+_0x5f0ec5(0x21b)+btoa(_0x20e5a9);}return _0x13bdaf;});const _0x5678de=btoa(_0x3ffc93[_0x357f63(0x218)]('\x0a'));return new Response(_0x5678de,{'headers':{'Content-Type':_0x357f63(0x1ef)}});}