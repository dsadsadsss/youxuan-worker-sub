//设置变量SUB,节点名称设为Country-名称，优选ip设置为ip.sb,会自动替换国家和优选
//订阅链接格式:域名/token=值?cf_port=值
//以下是我找到的优选ip的api地址，你也可以搭建自己的api
//https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestproxy.txt
//https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestcf.txt
//https://ip.164746.xyz/ipTop10.html
//https://vps789.com/public/sum/cfIpApi
//https://www.wetest.vip/api/cf2dns/get_cloudflare_ip&type=v4&key=o1zrmHAF
//https://raw.githubusercontent.com/cmliu/WorkerVless2sub/main/addressesapi.txt
//https://addressesapi.090227.xyz/CloudFlareYes
const CONFIG = {
    TOKEN: '111',  //订阅链接密钥
    API: 'https://addressesapi.090227.xyz/CloudFlareYes;https://raw.githubusercontent.com/cmliu/WorkerVless2sub/main/addressesapi.txt;https://raw.githubusercontent.com/ymyuuu/IPDB/refs/heads/main/bestcf.txt;https://ip.164746.xyz/ipTop10.html',  //优选ip的api,多个用;隔开
    SUB: '',  //自定义链接,多个用;隔开
    CFIPS: 'ip.sb;bestcf.030101.xyz;cf.877774.xyz' ,//优选域名,多个用;隔开
    COUNTRY_REPLACE: 'YM' // 优选域名节点国家的拼音简称
};
//排除包含关键词的节点
const excludeKeywords = 'GB-eu.com;TW-free.tw';


const _0x5b377b=_0x5558;(function(_0x28f3e6,_0x5e4521){const _0x5ad854=_0x5558,_0x2f9fe6=_0x28f3e6();while(!![]){try{const _0x18632d=parseInt(_0x5ad854(0x17a))/0x1+parseInt(_0x5ad854(0x174))/0x2+-parseInt(_0x5ad854(0x16a))/0x3+-parseInt(_0x5ad854(0x16b))/0x4+-parseInt(_0x5ad854(0x149))/0x5+parseInt(_0x5ad854(0x145))/0x6*(parseInt(_0x5ad854(0x166))/0x7)+parseInt(_0x5ad854(0x175))/0x8;if(_0x18632d===_0x5e4521)break;else _0x2f9fe6['push'](_0x2f9fe6['shift']());}catch(_0x3192c8){_0x2f9fe6['push'](_0x2f9fe6['shift']());}}}(_0x155e,0xeb1a8));const PROTOCOL={'xieyi':'vl','xieyi2':_0x5b377b(0x170),'pm':'vm'};function preProcessUrl(_0xf7e42f){const _0x1942a0=_0x5b377b,_0x2122f6=(_0xf7e42f[_0x1942a0(0x16d)](_0x1942a0(0x155))||_0xf7e42f[_0x1942a0(0x16d)](PROTOCOL['pm']+'ess://'))&&_0xf7e42f[_0x1942a0(0x157)]('://')[0x1]['charAt'](0x0)!=='{';if(_0x2122f6){const _0x386ea7=atob(_0xf7e42f[_0x1942a0(0x157)]('://')[0x1]);return PROTOCOL['pm']+'ess://'+_0x386ea7[_0x1942a0(0x150)](/\{PASS\}\-/g,'')[_0x1942a0(0x150)](/\{PA/g,PROTOCOL['xieyi'])[_0x1942a0(0x150)](/SS\}/g,PROTOCOL[_0x1942a0(0x159)])[_0x1942a0(0x150)](/\{BA/g,PROTOCOL['pm']);}return _0xf7e42f[_0x1942a0(0x150)](/\{PASS\}\-/g,'')[_0x1942a0(0x150)](/\{PA/g,PROTOCOL[_0x1942a0(0x153)])[_0x1942a0(0x150)](/SS\}/g,PROTOCOL['xieyi2'])[_0x1942a0(0x150)](/\{BA/g,PROTOCOL['pm']);}function shouldExcludeUrl(_0x147c82){const _0x275e8d=_0x5b377b;return excludeKeywords[_0x275e8d(0x157)](';')[_0x275e8d(0x16e)](_0xf5f736=>_0xf5f736[_0x275e8d(0x15e)]())['some'](_0x33b4aa=>_0x147c82[_0x275e8d(0x18b)](_0x33b4aa));}function _0x155e(){const _0x55e1a2=['error','=none','country','headers','pathname','SUB','replace','join','COUNTRY_REPLACE','xieyi','searchParams','{BASS}://','push','split','application/json','xieyi2','unknown','charAt','https://ipinfo.io/','处理订阅链接失败:','trim','/json','API','match','订阅内容不是base64编码，使用原始内容','TOKEN','text/plain','Error\x20fetching\x20country\x20for\x20IP\x20','6965357itJpIX','length','Error\x20fetching\x20or\x20processing\x20IP\x20data:','Not\x20Found','1183743LbKhoc','6972348giRJPg','log','startsWith','map','warn','ess','No\x20valid\x20IP\x20data\x20found\x20from\x20any\x20API\x20endpoints','some','Error\x20parsing\x20JSON','1382208eOwOKu','16494816sMDepc','get','all','8080','filter','313531wPsvAq','No\x20valid\x20IP\x20data\x20found','http://','trimStart','Error\x20processing\x20IP\x20data','https://','Country','json','concat','status','ess://','string','text','object','cf_port','Error\x20fetching\x20data\x20from\x20','url','includes','forEach','No\x20API\x20endpoints\x20provided','6kDXHYq','Error\x20fetching\x20or\x20processing\x20data','CFIPS','://','4804430ShJQDH'];_0x155e=function(){return _0x55e1a2;};return _0x155e();}function getSubUrls(_0x34bde1){const _0x45327c=_0x5b377b;return(_0x34bde1[_0x45327c(0x14f)]||'')['split'](';')[_0x45327c(0x16e)](_0x11f72e=>_0x11f72e[_0x45327c(0x15e)]())['map'](_0x4df325=>preProcessUrl(_0x4df325))[_0x45327c(0x179)](_0x518d81=>typeof _0x518d81==='string'&&!shouldExcludeUrl(_0x518d81));}async function extractIpsFromResponse(_0x35b401){const _0xc9304a=_0x5b377b;let _0x3b6445=[];const _0x3cbf5b=_0x35b401[_0xc9304a(0x14d)][_0xc9304a(0x176)]('content-type');let _0x2f40cc;try{_0x2f40cc=await _0x35b401[_0xc9304a(0x186)]();if(_0x3cbf5b&&_0x3cbf5b['includes'](_0xc9304a(0x158)))try{_0x2f40cc=JSON['parse'](_0x2f40cc);const _0xc554ba=_0x2fe4e1=>{const _0x402560=_0xc9304a;if(typeof _0x2fe4e1==='string'){const _0x4d742e=_0x2fe4e1['match'](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/);_0x4d742e&&_0x3b6445[_0x402560(0x156)](_0x4d742e[0x0]['trim']());}else{if(Array['isArray'](_0x2fe4e1))_0x2fe4e1[_0x402560(0x18c)](_0x5921a3=>{const _0x486c78=_0x402560;if(typeof _0x5921a3===_0x486c78(0x185)){const _0x118fd7=_0x5921a3[_0x486c78(0x161)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/);_0x118fd7&&_0x3b6445['push'](_0x118fd7[0x0]['trim']());}else typeof _0x5921a3===_0x486c78(0x187)&&_0xc554ba(_0x5921a3);});else{if(typeof _0x2fe4e1===_0x402560(0x187)&&_0x2fe4e1!==null)for(const _0x34156d in _0x2fe4e1){_0x2fe4e1['hasOwnProperty'](_0x34156d)&&_0xc554ba(_0x2fe4e1[_0x34156d]);}}}};_0xc554ba(_0x2f40cc);}catch(_0x5f5324){console[_0xc9304a(0x14a)](_0xc9304a(0x173),_0x5f5324);const _0x4499ba=_0x2f40cc[_0xc9304a(0x161)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/gm)||[];_0x3b6445[_0xc9304a(0x156)](..._0x4499ba);}else{const _0x3b0700=_0x2f40cc[_0xc9304a(0x161)](/^(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(:\d+)?/gm)||[];_0x3b6445[_0xc9304a(0x156)](..._0x3b0700);}}catch(_0x386521){console[_0xc9304a(0x14a)](_0xc9304a(0x146),_0x386521);}return[...new Set(_0x3b6445)]['filter'](Boolean);}function _0x5558(_0x4d416e,_0x293ca1){const _0x155e6a=_0x155e();return _0x5558=function(_0x5558c7,_0x31d0d5){_0x5558c7=_0x5558c7-0x145;let _0x17a08f=_0x155e6a[_0x5558c7];return _0x17a08f;},_0x5558(_0x4d416e,_0x293ca1);}export default{async 'fetch'(_0x12993f,_0x5c613c){const _0xb854a1=_0x5b377b,_0x25afa0=new URL(_0x12993f[_0xb854a1(0x18a)]);if(_0x25afa0[_0xb854a1(0x14e)]==='/'||_0x25afa0[_0xb854a1(0x14e)]==='')return new Response('Hello\x20World',{'headers':{'content-type':_0xb854a1(0x164)}});if(_0x25afa0['pathname']==='/token='+CONFIG[_0xb854a1(0x163)])return handleToken(_0x12993f,_0x5c613c);return new Response(_0xb854a1(0x169),{'status':0x194});}};async function handleToken(_0x4ff4c9,_0x14f955){const _0xac87e=_0x5b377b,_0x496e30=new URL(_0x4ff4c9[_0xac87e(0x18a)])[_0xac87e(0x154)][_0xac87e(0x176)](_0xac87e(0x188));if(!_0x496e30)return new Response('Missing\x20cf_port',{'status':0x190});let _0x523296=[];const _0x558796=(CONFIG[_0xac87e(0x160)]||'')[_0xac87e(0x157)](';')[_0xac87e(0x16e)](_0xe52e5d=>_0xe52e5d[_0xac87e(0x15e)]())[_0xac87e(0x179)](Boolean);if(_0x558796[_0xac87e(0x167)]===0x0)return new Response(_0xac87e(0x18d),{'status':0x190});try{let _0x3edaa8=[];for(const _0xfd3e03 of _0x558796){try{const _0x51f34e=await fetch(_0xfd3e03);if(!_0x51f34e['ok']){console['error']('HTTP\x20Error\x20for\x20'+_0xfd3e03+':\x20'+_0x51f34e[_0xac87e(0x183)]);continue;}const _0x526289=await extractIpsFromResponse(_0x51f34e);_0x3edaa8['push'](..._0x526289);}catch(_0x2f8206){console['error'](_0xac87e(0x189)+_0xfd3e03+':',_0x2f8206);}}if(_0x3edaa8[_0xac87e(0x167)]===0x0)return new Response(_0xac87e(0x171),{'status':0x190});const _0x9512bc=[...new Set(_0x3edaa8)][_0xac87e(0x179)](Boolean);_0x523296=await Promise[_0xac87e(0x177)](_0x9512bc[_0xac87e(0x16e)](async _0x4ad9a1=>{const _0x2f707a=_0xac87e;try{const _0x4936cf=await fetch(_0x2f707a(0x15c)+_0x4ad9a1[_0x2f707a(0x157)](':')[0x0]+_0x2f707a(0x15f));if(!_0x4936cf['ok'])return console[_0x2f707a(0x16f)](_0x2f707a(0x165)+_0x4ad9a1+':\x20'+_0x4936cf[_0x2f707a(0x183)]),{'ip':_0x4ad9a1,'country':_0x2f707a(0x15a)};return{'ip':_0x4ad9a1,'country':(await _0x4936cf[_0x2f707a(0x181)]())[_0x2f707a(0x14c)]||_0x2f707a(0x15a)};}catch(_0x150ee3){return console['warn']('Error\x20fetching\x20country\x20for\x20IP\x20'+_0x4ad9a1+':\x20'+_0x150ee3),{'ip':_0x4ad9a1,'country':_0x2f707a(0x15a)};}}));if(_0x523296[_0xac87e(0x167)]===0x0)return new Response(_0xac87e(0x17b),{'status':0x190});}catch(_0x345ced){return console[_0xac87e(0x14a)](_0xac87e(0x168),_0x345ced),new Response(_0xac87e(0x17e),{'status':0x1f4});}let _0x3d689d=getSubUrls(_0x14f955);const _0x1413ec=_0x3d689d[_0xac87e(0x179)](_0x1b6053=>!excludeKeywords[_0xac87e(0x157)](';')[_0xac87e(0x16e)](_0x44a47f=>_0x44a47f[_0xac87e(0x15e)]())[_0xac87e(0x172)](_0x27e8e6=>_0x1b6053['includes'](_0x27e8e6)));let _0x1c6ac5=[];const _0x5df485=(CONFIG[_0xac87e(0x147)]||'')[_0xac87e(0x157)](';')[_0xac87e(0x16e)](_0x4e9613=>_0x4e9613[_0xac87e(0x15e)]())[_0xac87e(0x179)](Boolean);for(const _0x5389b2 of _0x1413ec){for(const _0x25c9b9 of _0x5df485){let _0x3a6b36=_0x5389b2;_0x5389b2[_0xac87e(0x18b)](_0xac87e(0x180))?(_0x3a6b36=_0x3a6b36['replace'](/ip\.sb/g,_0x25c9b9)['replace'](/Country/g,CONFIG[_0xac87e(0x152)]),_0x3a6b36=_0x3a6b36[_0xac87e(0x150)](/\b(443|8443)\b/g,_0x496e30)):(_0x3a6b36=_0x3a6b36[_0xac87e(0x150)](/YOUXUAN_IP|ip\.sb/g,_0x25c9b9),_0x3a6b36=_0x3a6b36['replace'](/\b(443|8443)\b/g,_0x496e30)),_0x3a6b36=_0x3a6b36[_0xac87e(0x150)](/CF_PORT/g,_0x496e30),(_0x496e30==='80'||_0x496e30==='8080')&&(_0x3a6b36=_0x3a6b36[_0xac87e(0x150)](/=tls/g,'=none')['replace'](/tls\",/g,'\x22,')),_0x1c6ac5[_0xac87e(0x156)](_0x3a6b36);}}for(const _0x2e3ffd of _0x1413ec){if(_0x2e3ffd[_0xac87e(0x18b)](_0xac87e(0x180)))for(const _0x2828f1 of _0x523296){let _0xf2a3c5=_0x2e3ffd[_0xac87e(0x150)](/ip\.sb/g,_0x2828f1['ip']['split'](':')[0x0])['replace'](/Country/g,_0x2828f1[_0xac87e(0x14c)]);const _0x4e8b30=_0x2828f1['ip']['match'](/:(\d+)$/);_0x4e8b30?_0xf2a3c5=_0xf2a3c5['replace'](/\b(443|8443)\b/g,_0x4e8b30[0x1]):_0xf2a3c5=_0xf2a3c5[_0xac87e(0x150)](/\b(443|8443)\b/g,_0x496e30),_0xf2a3c5=_0xf2a3c5[_0xac87e(0x150)](/CF_PORT/g,_0x496e30),(_0x496e30==='80'||_0x496e30===_0xac87e(0x178))&&(_0xf2a3c5=_0xf2a3c5['replace'](/=tls/g,_0xac87e(0x14b))[_0xac87e(0x150)](/tls\",/g,'\x22,')),_0x1c6ac5['push'](_0xf2a3c5);}else for(const _0x1613ba of _0x523296){let _0x1aab8c=_0x2e3ffd[_0xac87e(0x150)](/YOUXUAN_IP|ip\.sb/g,_0x1613ba['ip']['split'](':')[0x0]);const _0x5796c6=_0x1613ba['ip'][_0xac87e(0x161)](/:(\d+)$/);_0x5796c6?_0x1aab8c=_0x1aab8c[_0xac87e(0x150)](/\b(443|8443)\b/g,_0x5796c6[0x1]):_0x1aab8c=_0x1aab8c[_0xac87e(0x150)](/\b(443|8443)\b/g,_0x496e30),_0x1aab8c=_0x1aab8c['replace'](/CF_PORT/g,_0x496e30),(_0x496e30==='80'||_0x496e30===_0xac87e(0x178))&&(_0x1aab8c=_0x1aab8c['replace'](/=tls/g,_0xac87e(0x14b))[_0xac87e(0x150)](/tls\",/g,'\x22,')),_0x1c6ac5[_0xac87e(0x156)](_0x1aab8c);}}let _0x8f8ef7=[];for(const _0x502ad1 of _0x1c6ac5){if(_0x502ad1['toLowerCase']()['startsWith'](_0xac87e(0x17c))||_0x502ad1['toLowerCase']()[_0xac87e(0x16d)](_0xac87e(0x17f)))try{const _0x16b151=await fetch(_0x502ad1);let _0x11f8ee=await _0x16b151['text']();try{_0x11f8ee=atob(_0x11f8ee);}catch(_0x45a37e){console[_0xac87e(0x16c)](_0xac87e(0x162));}const _0x424c2b=_0x11f8ee[_0xac87e(0x157)]('\x0a')[_0xac87e(0x179)](_0x469088=>_0x469088[_0xac87e(0x15e)]())[_0xac87e(0x179)](_0x182770=>!shouldExcludeUrl(_0x182770));_0x8f8ef7=_0x8f8ef7[_0xac87e(0x182)](_0x424c2b);}catch(_0x599dd4){console['error'](_0xac87e(0x15d),_0x599dd4);}else _0x8f8ef7['push'](_0x502ad1);}_0x8f8ef7=_0x8f8ef7['map'](_0x5bc367=>{const _0x1cc8e6=_0xac87e;if(_0x5bc367[_0x1cc8e6(0x16d)]('{BASS}://')||_0x5bc367[_0x1cc8e6(0x16d)](PROTOCOL['pm']+_0x1cc8e6(0x184))){const _0x357811=_0x5bc367['split'](_0x1cc8e6(0x148))[0x1];if(_0x357811&&_0x357811[_0x1cc8e6(0x17d)]()[_0x1cc8e6(0x15b)](0x0)==='{')return PROTOCOL['pm']+_0x1cc8e6(0x184)+btoa(_0x357811);}return _0x5bc367;});const _0x290e50=btoa(_0x8f8ef7[_0xac87e(0x151)]('\x0a'));return new Response(_0x290e50,{'headers':{'Content-Type':_0xac87e(0x164)}});}